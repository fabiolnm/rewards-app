name: CI

on:
  pull_request:

jobs:
  validate:
    name: Validate PR
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Validate branch name
        run: scripts/check-branch-name
        env:
          BRANCH_NAME: ${{ github.head_ref }}

      - name: Validate PR commit authors
        run: scripts/ci-validate-pr-commits
        env:
          BASE_REF: ${{ github.event.pull_request.base.sha }}
          HEAD_REF: ${{ github.event.pull_request.head.sha }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install pre-commit
        run: pip install pre-commit

      - name: Run pre-commit checks
        run: pre-commit run --all-files --hook-stage pre-commit
        env:
          # Runs: markdownlint, hadolint-docker, trailing-whitespace,
          #       end-of-file-fixer, check-yaml, check-added-large-files,
          #       check-merge-conflict
          # Skipped:
          #   - check-branch-name (requires git context)
          #   - validate-commit-author (requires git context)
          #   - rubocop (separate step)
          SKIP: check-branch-name,validate-commit-author,rubocop
